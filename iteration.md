# Понављање

**[Сав код за ово поглавље можете пронаћи овде](https://github.com/marcetin/nauci-go-sa-testovima/tree/main/for)**

Да бисте у Го радили више пута, требат ће вам `for`. У Го нема кључних речи `while`,` do`, `until`, можете користити само` for`. Што је добро!

Напишимо тест за функцију која понавља знак 5 пута.

За сада нема ништа ново, па покушајте да то напишете сами за вежбање.

## Прво напишите тест

```go
package iteration

import "testing"

func TestRepeat(t *testing.T) {
	repeated := Repeat("a")
	expected := "aaaaa"

	if repeated != expected {
		t.Errorf("expected %q but got %q", expected, repeated)
	}
}
```

## Покушајте и покрените тест

`./repeat_test.go:6:14: undefined: Repeat`

## Напиши минималну количину кода за покретање теста и провери неуспешне резултате теста

_Држите дисциплину!_ Тренутно не морате знати ништа ново да би тест правилно пропао.

Све што сада треба да урадите је довољно да се направи компајлиран да бисте могли да проверите да ли је ваш тест добро написан.

```go
package iteration

func Repeat(character string) string {
	return ""
}
```

Није ли лепо знати да већ знаш довољно Иди да напишеш тестове за неке основне проблеме? То значи да се сада можете играти са продукцијским кодом колико год желите и знати да се понаша онако како бисте се надали.

`repeat_test.go:10: expected 'aaaaa' but got ''`

## Напишите довољно кода да прође

Синтакса `for` је врло неугледна и прати већину језика сличних Ц-у.

```go
func Repeat(character string) string {
	var repeated string
	for i := 0; i < 5; i++ {
		repeated = repeated + character
	}
	return repeated
}
```

За разлику од других језика као што су Ц, Јава или ЈаваСцрипт, не постоје заграде које окружују три компоненте израза фор и заграде `{ }` су увек потребне. Можда се питате шта се дешава у низу

```go
	var repeated string
```

пошто смо до сада користили `:=` за декларисање и иницијализацију променљивих. Међутим, `:=` је једноставно [запис за оба корака](https://gobyexample.com/variables). Овде декларишемо само променљиву `string`. Отуда експлицитна верзија. Такође можемо користити `var` за декларисање функција, као што ћемо видети касније.

Покрените тест и требало би да прође.

Додатне варијанте фор петље су описане [овде](https://gobyexample.com/for).

## Рефактор

Сада је време да се рефакторише и уведе још један конструкт `+=` оператор додељивања.

```go
const repeatCount = 5

func Repeat(character string) string {
	var repeated string
	for i := 0; i < repeatCount; i++ {
		repeated += character
	}
	return repeated
}
```

`+=` назван _"Add AND оператер доделе"_, додаје десни операнд левом операнду и додељује резултат левом операнду. Ради са другим врстама попут целих бројева.

### Бенчмаркинг

Писање [бенчмарка](https://golang.org/pkg/testing/#hdr-Benchmarks) у Го је још једна првокласна карактеристика језика и врло је слична писању тестова.

```go
func BenchmarkRepeat(b *testing.B) {
	for i := 0; i < b.N; i++ {
		Repeat("a")
	}
}
```

Видећете да је код врло сличан тесту.

`testing.B` даје вам приступ криптичном имену `b.N`.

Када се изврши референтни код, он се покреће `b.N` пута и мери колико траје.

Количина покретања кода не би вам требала бити важна, оквир ће одредити која је „добра“ вредност за то како бисте имали добре резултате.

Да бисте покренули тестове, учините `go test -bench=.` (или ако сте у Windows Powershell `go test -bench="."`)

```text
goos: darwin
goarch: amd64
pkg: github.com/marcetin/nauci-go-sa-testovima/for/v4
10000000           136 ns/op
PASS
```

Шта значи `136 ns/op` је да нашој функцији треба у просеку 136 наносекунди \ (на мом рачунару \). Што је прилично ок! Да би то тестирао, покренуо је 10000000 пута.

_НАПОМЕНА_ по дефаулту Референтни тестови се покрећу секвенцијално.

## Вежбајте вежбе

* Промените тест тако да позивалац може одредити колико пута се знак понавља, а затим поправити код
* Напишите `ExampleRepeat` да бисте документовали своју функцију
* Погледајте пакет [стрингс](https://golang.org/pkg/strings). Пронађите функције за које мислите да би могле бити корисне и експериментишите с њима писањем тестова какве имамо овде. Улагање времена у учење стандардне библиотеке временом ће се заиста исплатити.

## Завршница

* Више ТДД праксе
* Научено `for`
* Научио како да пише референтне вредности
